cmake_minimum_required(VERSION 2.8)
set(Boost_USE_STATIC_LIBS ON)
set(Boost_USE_MULTITHREADED ON)
set(Boost_USE_STATIC_RUNTIME OFF)
find_package(Boost 1.53)
SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -std=c++11")
include_directories(../include)

add_subdirectory(front_end)

macro(add_test_bin name source)
add_executable(${name} ${source})
target_include_directories(${name} PRIVATE ${Boost_INCLUDE_DIRS})
target_link_libraries(${name} boost_unit_test_framework)
add_test(${name} ${name})
endmacro(add_test_bin)

add_test_bin(test_simple test_simple.cpp)
add_test_bin(test_collections test_collections.cpp)
add_test_bin(test_html_escape test_html_escape.cpp)
add_test_bin(test_multiple test_multiple.cpp)
add_test_bin(test_nested_sections test_nested_sections.cpp)
add_test_bin(test_partials test_partials.cpp)
add_test_bin(test_sections test_sections.cpp)
add_test_bin(test_change_delimiter test_change_delimiter.cpp)
add_test_bin(test_inverted_sections test_inverted_sections.cpp)

cmake_policy(SET CMP0002 OLD)
add_custom_target(check COMMAND cd ${CMAKE_SOURCE_DIR}/src && CTEST_OUTPUT_ON_FAILURE=on make all test)
